endl = string.char(13)

terminal = getComponents("terminal")[1]
terminal.read()
terminal.clear()
terminal.write("#00ff00".. "Press 1 to enter coordinates" .. endl)

wayp = {
    {"const", "target","na", "na", "na", "na", "na", "na", "na","na"},
    {1000, 177.625, -2000, -4500, 0, 0, 0, 0, 0, 0},
    {1000, -200.375, -2000, -3500, 0, 0, 0, 0, 0, 0},
    {200, -12.375, 200, 200, 200, 0, 0, 0, 0, 0},
}

path = 0
case = 0
waypType = const
retry = false 
waypNum = 0
function sendPacket()
    local port = getPorts()[1]
    ded = sm.json.writeJsonString(wayp)
    port.send(ded)
    port.send("1")
    terminal.write("#ffff00".. "packet Sent" .. endl)
end
function drawMap()

    image = '000011111111111111001111110010011100000000000000000000000000000000000000000011100111111111111111111110111110111111010000000000000011111111111111111111111110000000000000000000000000000000000000000000000000011000111111111111111111110111100111111111000000000000011111111111111111110111111000000000000000000000000000000000000000000000010011000000000011111111111111000000011111111100000000000011111111111111111110011111000000000000000000000000000000000000000000000000011000000000011111111111100000000001111111100000000000001111111111111111111111111100000000000000000000000000000000000000000000001000000000000111111111111111000000000010111000000000000000001111111111111111111111110000000001000000000000001000000000000000000000000000000000111101111110111001000000000011000000000000000000111111111111111111111100000000011101010000000000000000000000000000000000000000000111111111110111000000000010000000000000000000001111111111111111011001000001100011100110000000000000000000000000000000000000000000111111111110111000000001110000000000000000000000111111111111111111100000010000011100000000000000000000000000000000000000000000000111110111110110000000000000000000000000000000000111111101111111110100011100000010000000000000000000000000000000000000000000000000011110011110110001010001110000000000000001011101111111001111101100010111111100000000000000000000000000000000000000000000000000000001110000110000000000000000000000000000001111011111111101110000110011111111110000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000011111111111111100000110011001111111111000000000000000000000000000000000000000001110000001110000000000000000010000000000000000001111011111111110000000111111101111111111000000000000000000000000000000000000001101110000111111000110001000000011000000000000000011111011111111111000000111111101111111111000000000000000000000000000000000000000111100000001110000000000100000011000000000000000101011111111100111110001111111101111111100000000000000000000001000000000000000000011000111001110000000000000000000000000000000001101111111111110010111101111111111111011000000000000000000000001110000000000000000000000111111110000000000000000000000000000000000000000000011000000011111111111111100000000000000000000000000000000000000000000000000000110000111000000000000000000000000000000000000000000000000000001111111110111000000000110000000000110000000000000000000001000000000100001111110110000000000000000010001110000000000000000111000011111111111111000000000000000000000000000000000000000000000000000000100011111100010000000000000000010011001000000000001100111110001111111111111100000000000000000000000000000000000000000000000000000111011111000000000000000000000010001011000011000011000011111010001111111111110000000000000000000000000000000000000000000000011110111111111100010000000000000001000000011010011011111000011111110001110110111100100000000000000000000000000000000000000000000011111111111111000000000000000000000000010001101111111110000001111110000110000111000110001100000000000000000000000000000000000000011111111111111100000000000000000000000010001111111011000000001111110000110000111100000000000000000000000000000000000000000000000011111110111111100000000000000000000000010011111111011000000001111111110111111111100100000000000000000000000000000000000000000000001111110001111100000000000000000000000000001111111011100000111111111111111111111000000000000000000000000000000000000000000000000000011110001111100100000000000000000000000000111000110000000111111111011100000000000000000000000000000000000000000000000000000000001111110101101110000000000000000000000000100000001010110111111111110000000010010000000000000000000000000000000000000000000000000011111110101100111000000000000000000000000110000011011110111111111110010000010000000000000000000000000000000000000000000000000000001011001101000111110000000000000000000000100000011111111110111111111000001100010000000000000000000000000000000000000000000000000000011101100000011100000000000000000000000000000011111011111111111111100011000111000000000000000000000000000000000010000000000000000000111000000101100000000000000000000000000001111011111111111111111110111000000000000000000000000000000000000000000000000000000000000111000000000000000000000000000000000111111111001111110111111111111111100000000000000000000000000000000000000000000000000000000001111111100010000000000000000000000000000001111111111111111111111111111100000000000000000000000000000000000000010000000000000000000100001000000000000000000000000000000100011111111111111111111111001100000000000000001100000000000000000000011111000000000000000000000001000000000000000000000000000000110011111011111111111111110111110000011101111111101000000000100000000001110000000000000000000000001110011000000000000000000011011111111111011111111111111111111111111111111001100011100000000011000000000000000011000000011100000000000111000110000000000000010011111111111001111111111111011111111111111111000001111100010000011000000010000000000100010011100000100000111100111000111100110000111111111111001111111111100001111111111111111001011111100101000011000000010000000000100010011100000101000111100111000111110110011111111111111011111111111111111111111111111111111111111111110000011000000011100000000011000011000000001000111100110000111111111101111111111111010111111111111111111111111111111111111111111110000010000010111101100000001000100000000000101111110010001111111111111111111111111001110111111111111111111111111111111111111111110000010001011111100000001110011111000000000001111110111000011111111111111111111111011111000111111111111111111111111111111111111110000111111111111000000000111111111100000000100111111111000000000111111111111111111111111000111111111111111111111110011111111111111000011111111111000000000111111111100000001100111111111100000000111111111111111111111011000111111111111111111111110001111111101111100011111111111111000001011111111100000001100111111111111000000011111111111111111011101011111111111111111111111111111111111101111111100111111111111110000111111111100000000001111110111111110001111111111111111111011111111111111111111111111111111111111111111111111111111100011111111111111111111100000000011111100001111111001111111111111111110011111111111111111111111111111111111111111111111111111110000001111111111111111111100000001110011010000111111100111111111111111100111111111111111111111110111111111111111111111111111111111000011111111111111111111100000001110001100000011111100011111111111111100011011111111111111011111111111111111111111111011111111111100111111111111111111111111011001100000100111111111100011111111111110000111111111111111111111111111111101111111111110001111111111111111111110111111110111111111011100001111111111111110111111111111110000111011111111111111111110111111100011111111110000001111111111111111111111111111111111111111000000001111110111111111111101111111110000011111111101111111111111111111011111111000001111111111111111111111111111111111111111110000000001111111001111111111111011111111000011111111110111111111111111111001111111111001111111101111111101111111111111111111111111000000000111110001111111000010001111110011111111111111111111111111111110000111111110001111111111111111111111100111111111111111111111000000111110011111111000111011111110011111111111111111111111111111110000000111010001111111111111111101111000001111111111111111111111101111111011111111111111110111110011111111111111111111111100111111000000001100011111111111111111111110000000011111111111111111111111111111111111111111111111000000111111111111111111111101000000111100000000000011111111111111110000000000000111111111111111111111111111111111111111111111111000000011111111111111111111110100010000000010000000111111111111111100000000000000111111111111111011111111111111111111111111011111000000011111111111111111111111000000000000000000000111111111111111100000000000000011111111011111101111111111111111111111111101111100000011111111111111111111111001011000111000000001111111111111111111110000000000011111111001111111111111111111111111111111111000000000011111111111111111111110100111111111100000011111001111111111111011111000000001111111001111111111111111111111100011111110000000000111111111111111111111111111111111111100000011000000111111100111100111000000001111111111111111111111111111111111111111110000000000011110111111111111111111111111111111100000001110000111011110111100010000000001011101110111111111111111111111111111111100000000000111111111111111111111111111111111111110000011110000111001111111111000000000001111111111111111111111111111011111111111100000000000011010111111111111111111111111111111111110111100111111111111111111100000000001111111111111111111111111110001101111001000000000000001001101111111111111111111111111111111100111111111111111111111111111111101111111111111111111111111111100001101000000011000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111110001111100000001100000100111111111111111111111111111111111111111111111111111111011111111111111111111111111111111111111111111111111000111111111010000011100111111111111111111111111111111111111111111111111111111011111111111111111111111111111111111111111110111111111111111111010000010100001001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000011001111111111001111111111111111110111111111111111111111111111111111111111111111111111111111111111001111111110111111001000000000111011111111110000111111111111111110011111111111111111111111111111111011111111111111011111111111111001111111111111100001000000000011111111111110000111111111111111110001111111111001111111110111111111010111111111110111111111111111001111111111111100001000000000111111111111000001111111111111100000011111111111111111111110111111110011111111111111111111111111111001111111111111100000000000000011111111111000011111111111100000011111111111111111111111111111111111111111111111000111111111111111111111111111111100000000000000001111111111111111100000000100000111111111111111111111111110011111111111111111111111111111111111111111111111111111011100000000000000100000011101000000000000000000000111111111111111111111011001111000001011111111110111110011111111111111111111110011001110000000000000000000010110000000000000000000011111111111111111111111001111100000000011111100011110001111111111111111111111111001111000000000000000000011110000000000000000000011111111111111111111111011111100000000011111111011110001111111111111111111111110001111000000000000000000000111010000000000000000001111111111111111111111010000000000000011111111111111111111111111100111111100000001110000000000000100000000011100000000000000000100011101111111111111111100010000000000011111111111111111111111110000000000000000000000000000000000111100110000000000000000000000000001111111111111111111000000000000000111111111101111111111111011000000000000000000000000000000000111100000000000000000000000000000001111111111111111111100001000000000011111101001111111110010111100000000000000000000001100000000110000000000000000000000000000000001111111111111100011100000000000000011111110011111111110000111000000000000000000000001100000000000000000000000000000000000000000011111111111111100001000000000000000011111111111111111111011110000000000010000000000001000000000000000000000000000100000000000000111111111111111110000000000000000000001111111111111011111111110000000001100000100000000000000000000000000000110000000000000000000011111111111111100000000000000000100100001111111100001111111110000100001100011100000001000001100000000000001110000000000000000000011111111111111110000000000011001110000000111111100001011111110001100001100111000000000000000100000000001001100000000010000000000011111111111111110000000000111111110000000111111100000011111110001100011100111100000000000000000000000000110000000001100000000000110111111111111000000000000001100000000001111111100000010000000000000000000101000000000000000000000000000101000000001100000000000000111111111110000000000000000000000000000011110111000000000000000000000000000000000000000000000000000000000000000001000000000000000111111111110000000000000000000000000000001100111110000000000000000000000011000000000000000000000000000000000000000000001100000000111111100110000000000000000000000000000111000001100000000000000000000000111100000000000000000000000000000000000000000011001100000111111100000000000000000000000000000000110100000000000000000000000000000111100000000000000000000000000000000000000000010000100001111111000000100000000000000000000000000000110000000000000000000010000000111000000000000000000000000000000000000000000000001111111111111000001100000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000001111111111111000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001111111111111100000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000001111111110011111000001100000000000000000000001100000010000000000000000000000000011000001100000000000000000000000000000000000000001111111111000100000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000001000000001111111111100100000000000000000000000000000000000000000000000000000000000000000000000010000000110000000000000000000110000000000000001111111111100110000100000000000000000000000000000000000000000000000000000000000000000000000000000000000001000001110000000000000111111111111000000000000001000000000000000011000000000000000000000000000000000000000000000000000000000011011000011110000000000001111111111111000000000000001000000000000000011000000000000000001000000000110000000000000000000001000000000000000010110000000000001111111111111000110000000000110000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111101111000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000111111111101111000000000000000000000000000000000000000000000000001100110000000000000000000000000001011000001000000000000000000000111111111101111100000000000000000000000000000000000000000000000000000111000000000000000000000000001110111111000000000000000000000111111111110111100000000000000000000000000000000000000000000000000001111000000000000000000001000000000000111000000000000000000100111111111111111000000000000000000000000000011000000000000000000000001111000000000000000000000000000000001110000000000000000000000011111111110011000000000000000000000000000000000100000000000000000000100000000000000000000000000000000000110001000000000000000000011111111111001000000000000000000000000000000000100000000000000000000000000000000000000001110000000000000000011111000000000000000111111111111000000000000000000000000000000000000000000000000000000001100000000000000000111100011110000000000111110001100000000000001111111111111101100000000000000000000000000000000000000000000001000000000000000000001111110001000000000000111110001100000000000010111111111111111100000000000000000000000000000000000000000000001001000000000000000001111110000000000000000000000010000000000000110111111111111111100000000000000000000000000000000000000000000000000000000000000000001111110000000000000000000000000000001000000110111111111111111100000000000000000100000000000000000000000000100000000000000000000000010011000000000000000001111000000000000000011111111111111111100000000000000000000001000000000000000000000000000000000000000000000011101000000000000000001111100000010000000000111111111101111110000000000000000001110000000000000000000000000000000000000000011111000000000000000000000001111000000000000000011111111111111111110000000000000000001100000100000000000000000000000000000000000011111000011000000000000000001110000000000000001110111111111111111111000000000000000000000011100001110000000000000000000000000000011111000011000000000000000010000000000000000001110011111111111111111100010000110100001000111111111111000000000010000000000000000011110000011000000001100000000000000000000000001111111111111111111111110010010000000000101111111111111100000000110000000000000001111010000001000000011110000110000100000000010001111111111111111111111111110011000000000101111111111111110000000000100000000000011111100000001000000111100000110000100000000010001111111111111111111111111111011100000000111011111111111111100000000000000000000011110110000001000000011100000000000000000000000001111111111111111111111111111111100001110111111111111111111110000000000000000000011110011100000001101000100110001000000000000000001111111100111110111111111111111111111111111111111111111111100000000100000000000100111101000'
    i = 1
    j = 1
    display = getDisplays()[1]
    display.clear("#000000")
    for j = 1,128 do
        for i = 1,129 do
        sum = (i) + (j-1) * 129
        print(image:sub(sum, sum))
            display.drawPixel(i-1, j-1, image:sub(sum, sum) == "1" and "#3BB143" or "#031521")
        end
        j = j + 1
    end
    display.forceFlush()
print(true)
end
display = getDisplays()[1]
drawMap()
display.flush()
function displayFPL()
    
   

    local termPosX = self.shape:getWorldPosition().x
    local termPosY = self.shape:getWorldPosition().y
    
       local temp = {
        {"na", "na","na", "na", "na" ,"na", "na", "na", "na","na"},
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        }

        for u = 1,4 do
            for v = 1,10 do
                temp[u][v] = wayp[u][v]
            end
        end

    for j = 1,10 do
       temp[2][j] = (  temp[2][j] + 6500)*0.01
       temp[3][j] = (- temp[3][j] + 6500)*0.01
    end
        

    if display == nil then return end
    
    drawMap()
    
    for i = 2,10 do
        display.drawCircle(((temp[2][1])), (temp[3][1]) , 1, "#009398")
        display.drawCircle(((temp[2][1])), (temp[3][1]) , 3, "#009398")
        display.drawText(temp[2][1], temp[3][1] - 6, tostring(1), "#FFFFFF")
        if temp[1][i] ~= "na" then
            display.drawLine( temp[2][i-1] , temp[3][i-1] , temp[2][i] , temp[3][i],  "#FF00FF")
            if temp[1][i] == "const" then
                display.drawCircle(((temp[2][i])), (temp[3][i]) , 2, "#0000FF")
                display.drawText(temp[2][i], temp[3][i] - 6, tostring(i), "#FFFFFF")
            elseif temp[1][i] == "player" or temp[1][i] == "upload" or  temp[1][i] == "target" then
                display.drawCircle(((temp[2][i])), (temp[3][i]) , 1, "#8B0000")
                display.drawCircle(((temp[2][i])), (temp[3][i]) , 3, "#8B0000")
                display.drawText(temp[2][i], temp[3][i] - 6, tostring(i), "#FFFFFF")
            else 
                display.drawCircle(((temp[2][i])), (temp[3][i]) , 1, "#3BB143")
            end
        end 
    end
    if temp[1][10] ~= "na" then
        display.drawCircle(((temp[2][10])), (temp[3][10]) , 1, "#0000FF")
    end
    
    display.drawCircle( (termPosX + 6500)*0.01, (6500 - termPosY)*0.01, 1, "#FFFF00")
    display.forceFlush() -- send data to render
    terminal.write("#ffff00".. "rendered" .. endl)
end

function callback_loop()
    local text = terminal.read()
    
    if text then
       case = text
       terminal.write("#00ff00> " .. text .. endl)
        if text == "end" then
            sendPacket()
        elseif path == "end" then 
            path = 0
            case = 0
            waypType = const
            retry = false 
            waypNum = 0
        elseif text == "display" then
            displayFPL()

        elseif text == "1" and path == 0 then
            print("true")
            terminal.write("#00ff00".. "Please Enter Coordinate Type" .. endl)
        elseif text == "print" then
            print("printTrue")
            for i = 1,10 do 
                count = i
                terminal.write("#00ff00 Waypoint: ".. count .. endl)
                terminal.write("#00ff00".. wayp[1][count] .. endl)
                terminal.write("#00ff00".. wayp[2][count] .. endl)
                terminal.write("#00ff00".. wayp[3][count] .. endl)
                terminal.write("#00ff00".. wayp[4][count] .. endl)
            end

        elseif path == 1 then
            waypNum = tonumber(text)
            path = 2
            wayp[1][waypNum] = "const"
            terminal.write("#00ff00".. "Please Enter X Value" .. endl)
        elseif path == 2 then
            terminal.write("#00ff00".. "Please Enter Y Value" .. endl)
            wayp[2][waypNum] = tonumber(text)
            path = 3
        elseif path == 3 then
            terminal.write("#00ff00".. "Please Enter Z Value" .. endl)
            wayp[3][waypNum] = tonumber(text)
            path = 4
        elseif path == 4 then
            wayp[4][waypNum] = tonumber(text)
            path = "end"
        
        
        elseif path == 5 then
            terminal.write("#00ff00".. "Please Enter Player Number" .. endl)
            wayp[1][waypNum] = "player"
            path = 6
        elseif path == 6 then
            wayp[2][waypNum] = tonumber(text)
            path = "end"


        elseif path == 10 then
            terminal.write("#00ff00".. "Please Enter Upload Index" .. endl)
            wayp[1][waypNum] = "upload"
            path = 11
        elseif path == 11 then
            wayp[2][waypNum] = tonumber(text)
            path = "end"


        elseif path == 15 then
            terminal.write("#00ff00".. "Please Enter Upload Index" .. endl)
            wayp[1][waypNum] = "land"
            path = 16
        
        elseif path == 20 then
            waypNum = tonumber(text)
            path = 21
            wayp[1][waypNum] = "target"
            terminal.write("#00ff00".. "Please Enter X Value" .. endl)
        elseif path == 21 then
            terminal.write("#00ff00".. "Please Enter Y Value" .. endl)
            wayp[2][waypNum] = tonumber(text)
            path = 22
        elseif path == 22 then
            terminal.write("#00ff00".. "Please Enter Z Value" .. endl)
            wayp[3][waypNum] = tonumber(text)
            path = 23
        elseif path == 23 then
            wayp[4][waypNum] = tonumber(text)
            path = "end"
        
        elseif path == 25 then
            waypNum = tonumber(text)
            path = 21
            wayp[1][waypNum] = "na"

        elseif text == "const" then
            path = 1
            terminal.write("#00ff00".. "Please Enter Waypoint Number" .. endl)
        elseif text == "player" then
            path = 5
            terminal.write("#00ff00".. "Please Enter Waypoint Number" .. endl)
        elseif text == "upload" then
            path = 10
            terminal.write("#00ff00".. "Please Enter Waypoint Number" .. endl)
        elseif text == "land" then
            path = 15
            terminal.write("#00ff00".. "Please Enter Waypoint Number" .. endl)
        elseif text == "target" then
            path = 20
            terminal.write("#00ff00".. "Please Enter Waypoint Number" .. endl)
        elseif text == "na" then
            path = 25
            terminal.write("#00ff00".. "Please Enter Waypoint Number" .. endl)
        elseif text == "/clear" then
            terminal.clear()
            drawMap()
            display.flush()
        else
        

            
        end

    end

    if _endtick then
        terminal.clear()
        display.clear("000000")
        display.flush()
    end
end

--> receiving packet code
-- local port = getPorts()[1]
--  if port.getPacketsCount() > 0 then
--  	local data = port.nextPacket()
-- dew = sm.json.parseJsonString(data)
-- print(dew[2][2])